<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéì Student Dashboard</h1>
            <div class="header-actions">
                <a href="/logout" class="logout-btn">Logout</a>
            </div>
        </div>

        <!-- Current Profile Summary -->
        {% if profile %}
        <div class="card">
            <h2>üë§ Your Profile Summary</h2>
            <div class="profile-card">
                {% if profile[7] %}
                <img src="/uploads/{{ profile[7] }}" alt="Profile Photo" class="profile-photo">
                {% else %}
                <div style="width: 120px; height: 120px; border-radius: 50%; background: var(--primary-gradient); display: flex; align-items: center; justify-content: center; font-size: 48px; color: white; box-shadow: var(--shadow-md);">
                    üë§
                </div>
                {% endif %}
                
                <div class="profile-info">
                    <h3>{{ session.name }}</h3>
                    <p><strong>Skills:</strong> {{ profile[1] or 'Not specified' }}</p>
                    <p><strong>CGPA:</strong> {{ profile[2] or 'Not specified' }}/10</p>
                    <p><strong>Interest Domain:</strong> {{ profile[3] or 'Not specified' }}</p>
                    <p><strong>Experience:</strong> {{ profile[4] or 0 }} years</p>
                    {% if profile[5] %}
                    <p><strong>Resume:</strong> <a href="/uploads/{{ profile[5] }}" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 600;">üìÑ View Resume</a></p>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Profile Update Form -->
        <div class="card">
            <h2>üìã Update Your Profile</h2>
            <form method="POST" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="skills">Skills (comma-separated)</label>
                    <input type="text" id="skills" name="skills" 
                           placeholder="Python, JavaScript, React, MySQL, Machine Learning"
                           value="{{ profile[1] if profile else '' }}" required>
                    <small style="color: #64748b; display: block; margin-top: 6px;">üí° Tip: List your technical skills separated by commas</small>
                </div>

                <details>
                    <summary>
                        <span>Additional Profile Details</span>
                        <span style="font-size: 12px; font-weight: normal; color: #64748b;">Click to expand ‚ñº</span>
                    </summary>

                    <div class="form-group">
                        <label for="cgpa">CGPA (0-10)</label>
                        <input type="number" id="cgpa" name="cgpa" step="0.01" min="0" max="10"
                               placeholder="8.5"
                               value="{{ profile[2] if profile else '' }}" required>
                    </div>

                    <div class="form-group">
                        <label for="interest_domain">Interest Domain</label>
                        <select id="interest_domain" name="interest_domain" required>
                            <option value="">-- Select Domain --</option>
                            <option value="AI" {% if profile and profile[3] == 'AI' %}selected{% endif %}>Artificial Intelligence</option>
                            <option value="Data Science" {% if profile and profile[3] == 'Data Science' %}selected{% endif %}>Data Science</option>
                            <option value="Cyber Security" {% if profile and profile[3] == 'Cyber Security' %}selected{% endif %}>Cyber Security</option>
                            <option value="Web Development" {% if profile and profile[3] == 'Web Development' %}selected{% endif %}>Web Development</option>
                            <option value="Mobile Development" {% if profile and profile[3] == 'Mobile Development' %}selected{% endif %}>Mobile Development</option>
                            <option value="Cloud Computing" {% if profile and profile[3] == 'Cloud Computing' %}selected{% endif %}>Cloud Computing</option>
                            <option value="DevOps" {% if profile and profile[3] == 'DevOps' %}selected{% endif %}>DevOps</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="experience_years">Years of Experience</label>
                        <input type="number" id="experience_years" name="experience_years" min="0" max="10"
                               placeholder="0"
                               value="{{ profile[4] if profile else '' }}" required>
                    </div>

                    <div class="form-group">
                        <label for="past_education">Past Education</label>
                        <textarea id="past_education" name="past_education" 
                                  placeholder="B.Tech in Computer Science, XYZ University, 2022‚Äì2026">{{ profile[6] if profile else '' }}</textarea>
                    </div>

                    <div class="form-group">
                        <label for="resume">Upload Resume (PDF)</label>
                        <input type="file" id="resume" name="resume" accept=".pdf">
                        <small style="color: #64748b; display: block; margin-top: 6px;">
                            üìå Important: Your resume will be analyzed and scored. Resumes scoring below 50/100 will be rejected.
                        </small>
                        {% if profile[5] %}
                            <p style="margin-top: 12px; color: #27ae60; font-weight: 600;">‚úÖ Current Resume: <a href="/uploads/{{ profile[5] }}" target="_blank" style="color: #667eea;">View</a></p>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="profile_photo">Upload Profile Photo</label>
                        <input type="file" id="profile_photo" name="profile_photo" accept="image/*">
                        {% if profile[7] %}
                            <img src="/uploads/{{ profile[7] }}" alt="Profile Photo" style="width: 100px; height: 100px; margin-top: 12px; border-radius: 50%; object-fit: cover; box-shadow: var(--shadow-md);">
                        {% endif %}
                    </div>
                </details>

                <button type="submit">üíæ Save Profile</button>
            </form>

            <!-- Resume Feedback Section -->
            {% if feedback_message %}
            <div class="feedback-box {% if resume_score and resume_score >= 50 %}success{% else %}danger{% endif %}">
                <h3>
                    {% if resume_score and resume_score >= 50 %}
                        ‚úÖ Resume Analysis Complete
                    {% else %}
                        ‚ùå Resume Analysis - Action Required
                    {% endif %}
                </h3>

                {% if resume_score is not none %}
                    <div class="feedback-score" style="color: {% if resume_score >= 50 %}var(--success-color){% else %}var(--danger-color){% endif %};">
                        {{ resume_score }}/100
                    </div>
                    
                    {% if resume_score >= 80 %}
                        <p style="font-weight: 600; color: var(--success-color); font-size: 18px;">üåü Excellent Resume! You're highly competitive.</p>
                    {% elif resume_score >= 50 %}
                        <p style="font-weight: 600; color: #f39c12; font-size: 18px;">‚≠ê Good Resume! Consider improvements below.</p>
                    {% else %}
                        <p style="font-weight: 600; color: var(--danger-color); font-size: 18px;">‚ö†Ô∏è Resume needs significant improvement!</p>
                    {% endif %}
                {% endif %}

                {% if detailed_feedback %}
                    <div class="feedback-breakdown">
                        <h4>üìä Detailed Breakdown:</h4>
                        <ul>
                            {% for category, data in detailed_feedback.items() %}
                                <li>
                                    <strong>{{ category }}:</strong> 
                                    <span style="color: {% if data.score >= data.max * 0.7 %}var(--success-color){% elif data.score >= data.max * 0.4 %}var(--warning-color){% else %}var(--danger-color){% endif %}; font-weight: 700;">
                                        {{ data.score }}/{{ data.max }}
                                    </span>
                                    ‚Äî {{ data.msg }}
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}

                <div style="margin-top: 24px; padding: 16px; background: rgba(255, 255, 255, 0.9); border-radius: 12px; line-height: 1.8;">
                    <p style="white-space: pre-line;">{{ feedback_message }}</p>
                </div>

                {% if resume_score is not none and resume_score < 50 %}
                    <div style="margin-top: 24px; padding: 18px; background: linear-gradient(135deg, #fff5f5 0%, #fed7d7 100%); border: 2px solid var(--danger-color); border-radius: 12px;">
                        <p style="font-weight: 700; color: var(--danger-color); margin: 0; font-size: 16px;">
                            üö´ Your resume was NOT saved (score below 50/100). Please improve based on the feedback above and upload again.
                        </p>
                    </div>
                {% endif %}
            </div>
            {% endif %}
        </div>

        <!-- Allocation Result -->
        <div class="card">
            <h2>üè¢ Your Internship Allocation</h2>
            
            {% if allocation %}
                <div class="allocation-box">
                    <h3>üéâ Congratulations! You've been allocated!</h3>
                    <p><strong>üè¢ Company:</strong> {{ allocation[0] }}</p>
                    <p><strong>üíº Domain:</strong> {{ allocation[1] }}</p>
                    <p><strong>üéØ Match Score:</strong> {{ allocation[2] }}/100</p>
                    <p><strong>üí∞ Stipend:</strong> ‚Çπ{{ allocation[4] }}/month</p>
                    <p><strong>üìç Location:</strong> {{ allocation[5] }}</p>
                    <p><strong>üèÜ Your Rank:</strong> <span class="rank-badge">Rank #{{ allocation[3] }}</span></p>
                </div>
            {% else %}
                <div class="empty-state">
                    <p>‚è≥</p>
                    <p>No internship allocated yet.</p>
                    <p style="font-size: 15px; margin-top: 12px; color: #64748b;">
                        Complete your profile with a high-quality resume and wait for the admin to run the allocation process.
                    </p>
                </div>
            {% endif %}
        </div>
    </div>
</body>
</html>